From 6a8765de45d1ab113f956cb40bfa942b8502266f Mon Sep 17 00:00:00 2001
From: Jacob Godserv <jacobgodserv@gmail.com>
Date: Sun, 21 Mar 2010 18:39:01 -0400
Subject: [PATCH 10/52] Only allow hooks to be run when the user requests them; and do not fail on a non-existant hooks directory

---
 pym/_emerge/main.py  |    3 ++-
 pym/portage/hooks.py |    3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/pym/_emerge/main.py b/pym/_emerge/main.py
index b1f9068..b2b74ea 100644
--- a/pym/_emerge/main.py
+++ b/pym/_emerge/main.py
@@ -1180,7 +1180,8 @@ def emerge_main():
 	# Portage needs to ensure a sane umask for the files it creates.
 	os.umask(0o22)
 	settings, trees, mtimedb = load_emerge_config()
-	HookDirectory('pre-run', settings).execute()
+	if "hooks" in settings['FEATURES']:
+		HookDirectory('pre-run', settings).execute()
 	portdb = trees[settings["ROOT"]]["porttree"].dbapi
 	rval = profile_check(trees, myaction)
 	if rval != os.EX_OK:
diff --git a/pym/portage/hooks.py b/pym/portage/hooks.py
index 844d17a..39ed413 100644
--- a/pym/portage/hooks.py
+++ b/pym/portage/hooks.py
@@ -31,7 +31,8 @@ class HookDirectory(object):
 		path = normalize_path(path)
 		
 		if not os.path.exists(path):
-			raise InvalidLocation('This hook path could not be found: ' + path)
+			self.output.warn('This hook path could not be found: ' + path)
+			return
 		
 		if os.path.isdir(path):
 			for parent, dirs, files in os.walk(path):
-- 
1.6.4.4

