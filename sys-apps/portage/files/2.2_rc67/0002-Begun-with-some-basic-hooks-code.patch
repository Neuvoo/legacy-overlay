From 7cb0685ff39cdcf80f240f51ac2ff39c634dddbf Mon Sep 17 00:00:00 2001
From: Jacob Godserv <jacobgodserv@gmail.com>
Date: Tue, 26 Jan 2010 00:58:43 -0500
Subject: [PATCH 02/52] Begun with some basic hooks code

---
 pym/portage/const.py |    1 +
 pym/portage/hooks.py |   33 +++++++++++++++++++++++++++++++++
 2 files changed, 34 insertions(+), 0 deletions(-)
 create mode 100644 pym/portage/hooks.py

diff --git a/pym/portage/const.py b/pym/portage/const.py
index 95ea76c..33fffd1 100644
--- a/pym/portage/const.py
+++ b/pym/portage/const.py
@@ -35,6 +35,7 @@ MODULES_FILE_PATH        = USER_CONFIG_PATH + "/modules"
 CUSTOM_PROFILE_PATH      = USER_CONFIG_PATH + "/profile"
 USER_VIRTUALS_FILE       = USER_CONFIG_PATH + "/virtuals"
 EBUILD_SH_ENV_FILE       = USER_CONFIG_PATH + "/bashrc"
+HOOKS_PATH               = USER_CONFIG_PATH + "/hooks"
 CUSTOM_MIRRORS_FILE      = USER_CONFIG_PATH + "/mirrors"
 COLOR_MAP_FILE           = USER_CONFIG_PATH + "/color.map"
 PROFILE_PATH             = "etc/make.profile"
diff --git a/pym/portage/hooks.py b/pym/portage/hooks.py
new file mode 100644
index 0000000..7ffdc82
--- /dev/null
+++ b/pym/portage/hooks.py
@@ -0,0 +1,33 @@
+# Copyright 1998-2010 Gentoo Foundation
+# Distributed under the terms of the GNU General Public License v2
+# $Id$
+
+from portage.const import BASH_BINARY, HOOKS_PATH
+from portage import os
+from portage import check_config_instance
+from process import spawn
+
+class hooks(object):
+
+	def __init__ (self, phase, settings):
+		check_config_instace(settings)
+		self.settings = settings
+		self.path = os.path.join(HOOKS_PATH, phase + ".d")
+
+	def execute (self):
+		if not path:
+			path = self.path
+			
+		path = normalize_path(path)
+		
+		if os.path.isdir(path):
+			for parent, dirs, files in os.walk(path):
+				for filename in files:
+					if filename[:1] == '.':
+						continue
+					self.execute(os.path.join(path, filename))
+		
+		elif os.path.isfile(path):
+			code = spawn(mycommand=[BASH_BINARY, path], env=mysettings.environ())
+			if code: # if failure
+				raise portage.exception.PortageException("!!! Hook %s failed with exit code %s" % (path, code))
-- 
1.6.4.4

